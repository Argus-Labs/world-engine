---
title: 'Message'
description: 'How to define and register a message'
---

Messages are predefined user actions that can be submitted to Cardinal and handled within a system. A message is the primary way of representing possible user actions in the game. After a message is processed within a tick, it returns a `Reply` payload that can be read by the game client.

In Cardinal, transactions are defined using a pair of Go structs representing a `Message` and a `Reply`.

**Example:**
- An `AttackPlayerMsg` message may contain the `TargetNickname` of the player you want to attack.
- A `MoveMsg` message may contain the `Direction` and `Distance` of the move.

---

## Using Messages

By convention, messages are defined in the `msg` directory, with each message definition in its own separate file.

You can easily create a new message and register it to the world by following these steps:

<Steps>
    <Step title="Define the message and reply struct">
        A message and its reply is defined as a Go struct.

        ```go /msg/msg_attack_player.go
        package msg
        
        type AttackPlayerMsg struct {
            TargetNickname string
        }

        type AttackPlayerMsgReply struct {
            Damage int
        }
        ```
    </Step>
    <Step title="Register the message in the world">
        Messages must be registered in the world before they can be used. This is done by calling the `RegisterMessage` function.

        ```go main.go
        package main

        func main() {
            w, err := cardinal.NewWorld()
            if err != nil {
                log.Fatal().Err(err).Msg("failed to create world")
            }
    
            // Register messages (user action)
            // NOTE: You must register your message here for it to be executed.
            err := cardinal.RegisterMessage[msg.AttackPlayerMsg, msg.AttackPlayerMsgReply](w, "attack_player")
            if err != nil {
                log.Fatal().Err(err).Msg("failed to register message")
            }
    
            // ...
        }
        ```
    </Step>
    <Step title="Iterate over messages in a system">
        Process each message in a system using cardinal.EachMessage.

        ```go /system/system_attack.go
        package system

        // If AttackSystem is registered with the cardinal World, it will be executed each tick.
        func AttackSystem(worldCtx cardinal.WorldContext) error {
            // Iterate over the messages that came in during the previous tick
            return cardinal.EachMessage[msg.AttackPlayerMsg, msg.AttackPlayerMsgReply](
                worldCtx,
                func(attack cardinal.TxData[msg.AttackPlayerMsg]) (msg.AttackPlayerMsgReply, error) {
                    // Handle attack logic here...
                })
        }
        ```
    </Step>
</Steps>

--- 
