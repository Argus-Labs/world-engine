
import { Callout } from 'nextra/components'

import Link from 'next/link'

# Queries

Queries enable Cardinal to handle requests for data from game state.

```go
package query

import "pkg.world.dev/world-engine/cardinal"

type PlanetInfoRequest struct {
	TargetID uint64
}

type PlanetInfoReply struct {
	Owner   string
	Level   uint8
	Energy  uint64
	Cap     uint64
	Silver  uint64
}

var PlanetInfo = cardinal.NewQueryType[PlanetInfoRequest, PlanetInfoReply](
	"planet-info",
	func(worldCtx cardinal.WorldContext, req PlanetInfoRequest) (PlanetInfoReply, error) {
		// do some query stuff...
		reply, err := doSomeQueryLogic(req)
		return reply, err
	},
)
```

## NewQueryType

`NewQueryType` creates a new `QueryType`. `QueryType`s wrap around a request and reply type. The request specifies the data needed for the query request. The reply type represents the data requested. Queries also require a function that implements the query.

<Callout type={"warning"}>
    Query handler functions can NOT modify state. State can only be modified in <Link href="/Cardinal/API-Reference/Systems">Systems</Link>. Attempts to modify state in a Query handler will result in an error.
</Callout>

```go
func NewQueryType[Request any, Reply any](
	name string,
	handler func(worldCtx WorldContext, req Request) (Reply, error),
) *QueryType[Request, Reply]
```

### Type Parameters

| Type Parameter | Description                                     |
|----------------|-------------------------------------------------|
| Request        | The type parameter representing the request type. |
| Reply          | The type parameter representing the reply type.   |

### Parameters

| Parameter   | Type                                          | Description                                                                                        |
|-------------|-----------------------------------------------|----------------------------------------------------------------------------------------------------|
| name        | string                                        | The name of the new query type.                                                                    |
| handler     | func(worldCtx WorldContext, req Request) (Reply, error) | The handler function for processing requests and generating a reply.                            |


### Return Value

| Return Type             | Description                                                             |
|-------------------------|-------------------------------------------------------------------------|
| *QueryType[Request, Reply] | A pointer to a new instance of QueryType[Request, Reply].                |


## NewQueryTypeWithEVMSupport

`NewQueryTypeWithEVMSupport` creates a new `QueryType` with EVM support, allowing this query to handle requests originating from EVM smart contracts.
<Callout type={"warning"}>
    Not all Go types are supported when using EVM supported queries. <Link href="/Cardinal/API-Reference/evm-support">Read More</Link>
</Callout>

```go
func NewQueryTypeWithEVMSupport[Request any, Reply any](
	name string,
	handler func(worldCtx WorldContext, req Request) (Reply, error),
) *QueryType[Request, Reply]
```

### Type Parameters

| Type Parameter | Description                                     |
|----------------|-------------------------------------------------|
| Request        | The type parameter representing the request type. |
| Reply          | The type parameter representing the reply type.   |

### Parameters

| Parameter   | Type                                          | Description                                                                                        |
|-------------|-----------------------------------------------|----------------------------------------------------------------------------------------------------|
| name        | string                                        | The name of the new query type.                                                                    |
| handler     | func(worldCtx WorldContext, req Request) (Reply, error) | The handler function for processing requests and generating a reply.                            |


### Return Value

| Return Type             | Description                                                             |
|-------------------------|-------------------------------------------------------------------------|
| *QueryType[Request, Reply] | A pointer to a new instance of QueryType[Request, Reply].                |


