import { Callout } from 'nextra/components'

# World

The `World` object is the manager of everything happening in the game. It deals with registering components, systems, transactions, and reads, as well as ticking the game simulation forward. `World` objects use [Redis](https://redis.io/) to store the game's state.


```go
package main

import (
    "log"
    "time"

    "pkg.world.dev/world-engine/cardinal"
)

func main() {
    redisAddr := os.Getenv("redis_address")
    redisPassword := os.Getenv("redis_password")

    world, err := cardinal.NewWorld(
		redisAddr,
		redisPassword,
		cardinal.WithNamespace("my-world"),
		cardinal.WithReceiptHistorySize(10),
		cardinal.WithTickInterval(500 * time.Millisecond),
		cardinal.WithPort("4001"),
	)
    if err != nil {
        log.Fatal(err)
    }
}
```

## NewWorld

`NewWorld` creates a new `World` object.

```go
func NewWorld(addr, password string, opts ...WorldOption) (*World, error)
```

### Parameters
| Parameter | Type                        | Description                                               |
|-----------|-----------------------------|-----------------------------------------------------------|
| s         | storage.WorldStorage       | The storage backend to be used for the world.             |
| opts      | ...WorldOption                  | Options for configuring the world.  |

### Return Values

| Type  | Description                                      |
|--------------|--------------------------------------------------|
| *World       | A pointer to the newly created World instance.  |
| error        | An error indicating any issues during creation. |

### Options

#### WithAdapter

The `WithAdapter` world option enables `World` objects to read/write transactions to/from the sequencer (EVM base shard), and rebuild game state from those transactions. When running World Engine in production, the `WithAdapter` option must be used.

```go
func WithAdapter(adapter shard.Adapter) Option
```

| Parameter | Type              | Description                              |
|-----------|-------------------|------------------------------------------|
| adapter   | shard.Adapter     | The adapter to be associated with World. |

#### WithReceiptHistorySize

The `WithReceiptHistorySize` option informs the `World` object on how many ticks the `World` should keep receipts for. For example, if we are on tick 40, and have a receipt history size of 5, the `World` will have receipts for ticks 35-39. On tick 41, the `World` will have receipts for ticks 36-40.

```go
func WithReceiptHistorySize(size int) Option
```

| Parameter | Type     | Description                                           |
|-----------|----------|-------------------------------------------------------|
| size      | int      | The size of the receipt history to be set for World. |


#### WithNamespace

The `WithNamespace` allows the `World` to have a custom Namespace. Namespaces are used to differentiate `World` objects that post data to the EVM base shard.

```go
func WithNamespace(id string) Option
```
| Parameter | Type    | Description                                   |
|-----------|---------|-----------------------------------------------|
| ns        | string  | The namespace to be set for World. |


#### WithPort

The `WithPort` option allows for a custom port to be set for the World's server. If this option is unset, Cardinal checks for a `CARDINAL_PORT` environment variable. If that is also unset, it uses a default port of 4040.

```go
func WithPort(port string) WorldOption
```

| Parameter | Type    | Description                                   |
|-----------|---------|-----------------------------------------------|
| port        | string  | The port number for the world's server. |


#### WithDisableSignatureVerification

The `WithDisableSignatureVerification` disables signature verification on the World's server. This should only be used for testing.

```go
func WithDisableSignatureVerification() WorldOption
```
This method has no parameters.

#### WithLoopInterval

The `WithLoopInterval` sets the tick intervals of the World. If unset, a tick will occur every 1 second.

```go
func WithLoopInterval(interval time.Duration) WorldOption {
```

| Parameter | Type    | Description                                   |
|-----------|---------|-----------------------------------------------|
| interval        | time.Duration  | The interval of time for each tick. |


##### Example

```go
// option to make ticks happen every 500 milliseconds.
opt := WithLoopInterval(500 * time.Millisecond)
```

## Methods

### RegisterSystems

`RegisterSystems` registers one or more systems to the `World`. Systems are executed in the order of which they were added to the world.

```go
func (w *World) RegisterSystems(s ...System)
```

#### Example

```go
package main

import (
    "github.com/my-username/my-world-engine-project/systems"
)

func main() {
    // ... world setup ...

	// Systems will run in order in which they are added:
	// 1. MoveSystem
	// 2. HealthRegenSystem
	// 3. AttackSystem
    world.RegisterSystems(systems.MoveSystem, systems.HealthRegenSystem, systems.AttackSystem)
}
```

#### Parameters

| Parameter | Type         | Description                                             |
|-----------|--------------|---------------------------------------------------------|
| s         | ...System    | Variadic parameter for systems to be added to the World. |


### RegisterComponents

`RegisterComponents` registers one or more components to the `World`. Upon registration, components are assigned an ID. IDs are assigned incrementally, starting from 0, in the order in which they were passed to the method.


<Callout type={"warning"}>
    `RegisterComponents` can be only be called once. Subsequent calls to the method will return an error.
</Callout>


```go
func (w *World) RegisterComponents(components ...AnyComponentType) error
```
#### Example

```go
package main

import (
    "log"

    "github.com/my-username/my-world-engine-project/component"
)

func main() {
    // ... world setup ...

    err := world.RegisterComponents(
		component.LocationComponent,
		component.AttackPowerComponent,
		component.HealthComponent,
	)
	if err != nil {
		log.Fatal(err)
	}
}
```

#### Parameters

| Parameter    | Type                    | Description                                                    |
|--------------|-------------------------|----------------------------------------------------------------|
| components   | ...AnyComponentType | Variadic parameter for components to be registered with the World. |

#### Return Value

| Type | Description                                                                  |
|-------------|------------------------------------------------------------------------------|
| error       | An error indicating any issues that occurred during the component registration. |


### RegisterReads

`RegisterReads` registers the reads in the `World`. This allows the `Read` endpoints to be automatically generated.

```go
func (w *World) RegisterReads(reads ...AnyReadType) error
```
#### Example

```go
package main

import (
    "log"

    "github.com/my-username/my-world-engine-project/read"
)

func main() {
    // ... world setup ...

    err := world.RegisterReads(
		read.ReadLocation,
		read.ReadHealth,
		read.ReadAttackPower,
	)
	if err != nil {
		log.Fatal(err)
	}
}
```
#### Parameters
| Parameter    | Type       | Description                                                   |
|--------------|------------|---------------------------------------------------------------|
| reads        | ...AnyReadType   | Variadic parameter for IRead instances to be registered.      |


#### Return Value
| Type   | Description                                                               |
|--------|---------------------------------------------------------------------------|
| error  | An error indicating any issues that occurred during the read registration. |

### RegisterTransactions

`RegisterTransactions` registers the transactions in the `World`. This allows transaction endpoints to be automatically generated.

<Callout type={"warning"}>
    `RegisterTransactions` can be only be called once. Subsequent calls to the method will return an error.
</Callout>

```go
func (w *World) RegisterTransactions(txs ...AnyTransaction) error
```

#### Example
```go
package main

import (
    "log"

    "github.com/my-username/my-world-engine-project/tx"
)

func main() {
    // ... world setup ...

    err := world.RegisterTransactions(
		tx.MoveTx,
		tx.AttackTx,
	)
	if err != nil {
		log.Fatal(err)
	}
}
```

#### Parameters
| Parameter        | Type                | Description                                                    |
|------------------|---------------------|----------------------------------------------------------------|
| txs              | ...AnyTransaction                 | Variadic parameter for ITransaction instances to be registered. |

#### Return Value
| Type   | Description                                                               |
|--------|---------------------------------------------------------------------------|
| error  | An error indicating any issues that occurred during the transaction registration. |


### CreateMany

`CreateMany` creates a specified amount of entities with a specified set of components.

```go
func (w *World) CreateMany(num int, components ...AnyComponentType) ([]EntityID, error)
```

#### Example
```go
package main

import (
    "log"

    "github.com/my-username/my-world-engine-project/components"
)

func main() {
    // ... world setup ...

	// create 10 entities with the location and health component.
    entityIDs, err := world.CreateMany(
		10,
		components.LocationComponent,
		components.HealthComponent,
	)
	if err != nil {
		log.Fatal(err)
	}
}
```

#### Parameters

| Parameter    | Type                | Description                                                                                               |
|--------------|---------------------|-----------------------------------------------------------------------------------------------------------|
| num          | int                 | The number of entities to create.                                                                        |
| components   | ...AnyComponentType | Variadic parameter for components to associate with the created entities.                             |

#### Return Values

| Type             | Description                                                                   |
|------------------|-------------------------------------------------------------------------------|
| []EntityID | A slice of EntityID representing the IDs of the created entities.    |
| error            | An error indicating any issues that occurred during the creation process.  |

### Create

`Create` creates a single entity with a given set of components.

```go
func (w *World) Create(components ...AnyComponentType) (EntityID, error)
```

#### Example
```go
package main

import (
    "log"

    "github.com/my-username/my-world-engine-project/components"
)

func main() {
    // ... world setup ...

	// create an entity with the location and health component.
    entityID, err := world.Create(
		components.LocationComponent,
		components.HealthComponent,
	)
	if err != nil {
		log.Fatal(err)
	}
}
```

#### Parameters
| Parameter    | Type                | Description                                                                                               |
|--------------|---------------------|-----------------------------------------------------------------------------------------------------------|
| components   | ...AnyComponentType | Variadic parameter for components to associate with the created entity.                               |


#### Return Values
| Type             | Description                                                                   |
|------------------|-------------------------------------------------------------------------------|
| EntityID | The ID of the created entity.                                                 |
| error            | An error indicating any issues that occurred during the creation process.  |


### Remove

`Remove` removes a given entity from the `World`.

```go
func (w *World) Remove(id entity.ID) error
```

#### Example
```go
package main

import (
    "log"

    "github.com/my-username/my-world-engine-project/components"
)

func main() {
    // ... world setup ...

	// create an entity with the location and health component.
    entityID, err := world.Create(
		components.LocationComponent,
		components.HealthComponent,
	)
	if err != nil {
		log.Fatal(err)
	}

	// remove the entity we just created
	err = world.Remove(entityID)
		if err != nil {
		log.Fatal(err)
	}
}
```

#### Parameters
| Parameter    | Type                   | Description                                      |
|--------------|------------------------|--------------------------------------------------|
| id           | entity.ID              | The entity ID to be removed from the world.     |


#### Return Value
| Type   | Description                                                                                   |
|--------|-----------------------------------------------------------------------------------------------|
| error  | An error indicating any issues that occurred during the removal process.                   |

### StartGame

`StartGame` starts the game by loading any previously saved game state, spinning up the transaction/read handler, and starting the game ticks. This method blocks the main Go routine. If for whatever reason execution needs to continue after calling this method, it should be called in a separate go routine.

```go
func (w *World) StartGame() error
```

#### Return Value
| Type   | Description                                                                                   |
|--------|-----------------------------------------------------------------------------------------------|
| error  | An error indicating any issues when starting the game.                   |
