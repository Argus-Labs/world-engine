# Transactions

This API reference will help you understand how to use transactions and configuration options available for transactions.

```go
package components

import "pkg.world.dev/world-engine/cardinal/ecs"

// AttackInput is the input for the Attack transaction.
type AttackInput struct {
    TargetID uint64
}

// AttackOutput is the output for the Attack transaction.
type AttackOutput struct {
	Success bool
}

// AttackTx is an attack transaction.
var AttackTx = ecs.NewTransactionType[AttackInput, AttackOutput](
	"attack",
	ecs.WithTxEVMSupport[AttackInput, AttackOutput],
)
```

## NewTransactionType

`NewTransactionType` creates a new `TransactionType`. `TransactionType`s wrap around an input and output type. The input specifies the input for a transaction and the output represents the result of the transaction's execution.

```go
func NewTransactionType[In, Out any](
	name string,
	opts ...func() func(*TransactionType[In, Out]),
) *TransactionType[In, Out]
```

### Type Parameters

| Type Parameter | Type | Description                                     |
|----------------|------|-------------------------------------------------|
| In             | any  | The input type of the transaction.              |
| Out            | any  | The output type of the transaction.             |


### Parameters

| Parameter | Type                                  | Description                                         |
|-----------|---------------------------------------|-----------------------------------------------------|
| name      | string                                | The name of the new transaction type, as well as the name of the endpoint for this transaction               |
| opts      | func() func(*TransactionType[In, Out]) | Optional functional options for configuring the transaction type. |

### Return Value

| Type                 | Description                                       |
|----------------------|---------------------------------------------------|
| *TransactionType[In, Out]    | A pointer to a new instance of TransactionType[In, Out].  |

## Options

### WithTxEVMSupport

The `WithTxEVMSupport` enables this transaction to be sent from EVM smart contracts. Note: the option requires the type parameters again. This is needed so option can generate the concrete EVM equivalent types for the inputs and outputs of the transaction.


import { Callout } from 'nextra/components'

import Link from 'next/link'

<Callout type={"warning"}>
    Not all Go types are supported when using `WithTxEVMSupport`. <Link href="/Cardinal/API-Reference/evm-support">Read More</Link>
</Callout>

```go
func WithTxEVMSupport[In, Out any]() func(transactionType *TransactionType[In, Out])
```

## Methods

### AddToQueue

`AddToQueue` adds a transaction to the world's queue, enabling it to be executed in the next game tick.

```go
func (t *TransactionType[In, Out]) AddToQueue(world *World, data In, sigs ...*sign.SignedPayload) transaction.TxID
```

#### Example
```go
txID := AttackTx.AddToQueue(w, AttackInput{TargetID: 3502})
```

#### Parameters

| Parameter   | Type                 | Description                                                                          |
|-------------|----------------------|--------------------------------------------------------------------------------------|
| world       | *World               | A pointer to a World instance to which the transaction will be added.               |
| data        | In                   | The transaction input data.                                      |
| sigs        | ...*sign.SignedPayload | Variadic parameter for signed payloads associated with the transaction (optional).   |

#### Return Value

| Type | Description                                                                           |
|-------------|---------------------------------------------------------------------------------------|
| transaction.TxID | The unique transaction ID assigned to the newly added transaction in the world object.  |

### AddError

`AddError` adds an error to a specific transaction that signifies an issue has occurred with the transaction's execution.

```go
func (t *TransactionType[In, Out]) AddError(world *World, id transaction.TxID, err error)
```

#### Example

```go
AttackTx.AddError(w, txID, fmt.Errorf("player does with id %d does not exist", txID))
```

#### Parameters

| Parameter   | Type                 | Description                                           |
|-------------|----------------------|-------------------------------------------------------|
| world       | *World               | A pointer to a World instance.  |
| id          | transaction.TxID     | The ID of the transaction.         |
| err         | error                | The error to be associated with the transaction.     |

### SetResult

`SetResult` adds a result for a transaction's execution. `SetResult` uses the transaction type's output data structure for the result data. Setting a result for a transaction allows the result to be queried by clients.

```go
func (t *TransactionType[In, Out]) SetResult(world *World, id transaction.TxID, result Out)
```

#### Example

```go
AttackTx.SetResult(w, txID, AttackOutput{Success: true})
```

#### Parameters

| Parameter   | Type                 | Description                                           |
|-------------|----------------------|-------------------------------------------------------|
| world       | *World               | A pointer to a World instance.  |
| id          | transaction.TxID     | The ID of the transaction.       |
| result      | Out                  | The result to be associated with the transaction.    |


### GetReceipt

`GetReceipt` gets the result, if any, and errors, if any, associated with a specific transaction.

```go
func (t *TransactionType[In, Out]) GetReceipt(world *World, id transaction.TxID) (v Out, errs []error, ok bool)
```

#### Example
```go
output, errs, ok := AttackTx.GetReceipt(w, txID)
```

#### Parameters

| Parameter   | Type                 | Description                                         |
|-------------|----------------------|-----------------------------------------------------|
| world       | *World               | A pointer to a World instance.  |
| id          | transaction.TxID     | The ID of the transaction we want the receipt for.    |

#### Return Values

| Type        | Description                                                     |
|--------------------|-----------------------------------------------------------------|
| Out              | The transaction result.  |
| []error               | A slice of errors associated with the transaction.            |
| bool                 | A boolean indicating if the receipt was found in the world.  |

### In

`In` is a method primarily used in Systems that retrieve all transactions of the `TransactionType` from the `World`'s `TransactionQueue`.

```go
func (t *TransactionType[In, Out]) In(tq *TransactionQueue) []TxData[In]
```

#### Example

```go
txs := AttackTx.In(tq)
for _, tx := range txs {
	// ... do something with each tx
}
```

#### Parameters

| Parameter   | Type                 | Description                                           |
|-------------|----------------------|-------------------------------------------------------|
| tq          | *TransactionQueue    | A pointer to a TransactionQueue containing transactions. |


#### Return Value

| Type        | Description                                                     |
|--------------------|-----------------------------------------------------------------|
| []TxData[In]       | A slice of TxData - containing ID, Value (type: In), and a Signature.|
