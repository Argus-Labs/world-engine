# Transactions

This API reference will help you understand how to use transactions and configuration options available for transactions.

```go
package tx

import (
	"pkg.world.dev/world-engine/cardinal"
)

// AttackMsg is the input for the Attack transaction.
type AttackMsg struct {
    TargetID uint64
}

// AttackResult is the result of the Attack transaction.
type AttackResult struct {
	Success bool
}

// AttackTx is an attack transaction.
var AttackTx = cardinal.NewTransactionType[AttackMsg, AttackResult](
	"attack",
)
```

## NewTransactionType

`NewTransactionType` creates a new `TransactionType`. `TransactionType`s wrap around an input and output type. The input specifies the input for a transaction and the output represents the result of the transaction's execution.

```go
func NewTransactionType[Msg, Result any](
	name string,
	opts ...func() func(*TransactionType[Msg, Result]),
) *TransactionType[Msg, Result]
```

### Type Parameters

| Type Parameter | Type | Description                                     |
|----------------|------|-------------------------------------------------|
| Msg             | any  | The input type of the transaction.              |
| Result            | any  | The result type of the transaction.             |


### Parameters

| Parameter | Type                                  | Description                                         |
|-----------|---------------------------------------|-----------------------------------------------------|
| name      | string                                | The name of the new transaction type, as well as the name of the endpoint for this transaction               |
| opts      | func() func(*TransactionType[Msg, Result]) | Optional functional options for configuring the transaction type. |

### Return Value

| Type                 | Description                                       |
|----------------------|---------------------------------------------------|
| *TransactionType[Msg, Result]    | A pointer to a new instance of TransactionType[Msg, Result].  |

## Options

### WithTxEVMSupport

The `WithTxEVMSupport` enables this transaction to be sent from EVM smart contracts. Note: the option requires the type parameters again. This is needed so option can generate the concrete EVM equivalent types for the inputs and outputs of the transaction.


import { Callout } from 'nextra/components'

import Link from 'next/link'

<Callout type={"warning"}>
    Not all Go types are supported when using `WithTxEVMSupport`. <Link href="/Cardinal/API-Reference/evm-support">Read More</Link>
</Callout>

```go
func WithTxEVMSupport[Msg, Result any]() func(transactionType *TransactionType[Msg, Result])
```

## Methods

### AddError

`AddError` adds an error to a specific transaction that signifies an issue has occurred with the transaction's execution.

```go
func (t *TransactionType[Msg, Result]) AddError(world *World, id transaction.TxID, err error)
```

#### Example

```go
AttackTx.AddError(w, txID, fmt.Errorf("player does with id %d does not exist", txID))
```

#### Parameters

| Parameter   | Type                 | Description                                           |
|-------------|----------------------|-------------------------------------------------------|
| world       | *World               | A pointer to a World instance.  |
| id          | transaction.TxID     | The ID of the transaction.         |
| err         | error                | The error to be associated with the transaction.     |

### SetResult

`SetResult` adds a result for a transaction's execution. `SetResult` uses the transaction type's output data structure for the result data. Setting a result for a transaction allows the result to be queried by clients.

```go
func (t *TransactionType[Msg, Result]) SetResult(world *World, id transaction.TxID, result Out)
```

#### Example

```go
AttackTx.SetResult(w, txID, AttackResult{Success: true})
```

#### Parameters

| Parameter   | Type                 | Description                                           |
|-------------|----------------------|-------------------------------------------------------|
| world       | *World               | A pointer to a World instance.  |
| id          | transaction.TxID     | The ID of the transaction.       |
| result      | Out                  | The result to be associated with the transaction.    |


### GetReceipt

`GetReceipt` gets the result, if any, and errors, if any, associated with a specific transaction.

```go
func (t *TransactionType[Msg, Result]) GetReceipt(world *World, hash TxHash) (r Result, errs []error, ok bool)
```

#### Example
```go
output, errs, ok := AttackTx.GetReceipt(w, txID)
```

#### Parameters

| Parameter   | Type                 | Description                                         |
|-------------|----------------------|-----------------------------------------------------|
| world       | *World               | A pointer to a World instance.  |
| id          | TxHash    | The hash of the transaction for the receipt.    |

#### Return Values

| Type        | Description                                                     |
|--------------------|-----------------------------------------------------------------|
| Result              | The transaction result.  |
| []error               | A slice of errors associated with the transaction.            |
| bool                 | A boolean indicating if the receipt was found in the world.  |

### In

`In` is a method primarily used in Systems that retrieve all transactions of the `TransactionType` from the `World`'s `TransactionQueue`.

```go
func (t *TransactionType[Msg, Result]) In(tq *TransactionQueue) []TxData[In]
```

#### Example

```go
txs := AttackTx.In(tq)
for _, tx := range txs {
	// ... do something with each tx
	txVal := tx.Value()
	hash := tx.Hash()
	sig := tx.Sig()
}
```

#### Parameters

| Parameter   | Type                 | Description                                           |
|-------------|----------------------|-------------------------------------------------------|
| tq          | *TransactionQueue    | A pointer to a TransactionQueue containing transactions. |


#### Return Value

| Type        | Description                                                     |
|--------------------|-----------------------------------------------------------------|
| []TxData[Msg]       | A slice of TxData - containing TxHash, Value (type: Msg), and a Signature.|
